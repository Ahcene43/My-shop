<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø¨Ø³</title>
<style>
  body {
    font-family: "Cairo", sans-serif;
    direction: rtl;
    background: linear-gradient(135deg,#f8f9fa,#e9ecef);
    margin: 0;
    padding: 20px;
    color: #2c3e50;
  }
  h2 {
    text-align: center;
    color: #2563eb;
    margin-bottom: 20px;
  }
  form {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 700px;
    margin: auto;
  }
  label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
  }
  input, select { 
    width:97%; 
    padding:10px; 
    margin-top:7px; 
    border:1px solid #ccc; 
    border-radius:6px; 
    font-size:18px; 
  }
  button {
    background: #2563eb;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
    width: 97%;
    font-size: 16px;
  }
  button:hover {
    background: #1e40af;
  }
  .piece {
    border: 2px dashed #2563eb;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    background: #f0f9ff;
  }
  .piece img {
    display: block;
    margin: 10px auto;
    max-width: 200px;
    border-radius: 10px;
  }
  #priceDetails {
    margin-top: 15px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>ğŸ›’ Ø·Ù„Ø¨ÙŠØ© Ù…Ù„Ø§Ø¨Ø³</h2>
  
<form id="orderForm">
  <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
  <input type="text" name="name" required>

  <label for="phone">ğŸ“¦ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
  <input type="tel" id="phone" name="phone"
      dir="rtl"
      placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"
      pattern="^[0-9]{10}$"
      maxlength="10"
      required
      oninvalid="this.setCustomValidity('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…')"
      oninput="this.setCustomValidity('')">

  <label>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</label>
  <select id="wilaya" name="wilaya" required></select>

  <label>ğŸ“ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©:</label>
  <input type="text" name="daire" required>

  <label>ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„:</label>
  <input type="text" name="address" required>

  <div id="piecesContainer"></div>
  <button type="button" onclick="addPiece()">â• Ø£Ø·Ù„Ø¨ Ù†ÙˆØ¹ÙŠØ©</button>

  <label>ğŸšš Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
  <select id="deliveryType" name="deliveryType">
    <option value="home">Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„</option>
    <option value="desk">Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨</option>
  </select>

  <div id="priceDetails">
    ğŸ’° Ø§Ù„Ø³Ø¹Ø±: 0 Ø¯Ø¬<br>
    ğŸ’¸ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ: 0 Ø¯Ø¬
  </div>

  <button type="submit">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
  
  <div id="loading" style="display:none; text-align:center; margin-top:15px;">
  <img src="https://i.gifer.com/ZZ5H.gif" alt="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„..." width="60">
  <p>â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...</p>
</div>
</form>

<script>
let pieceCount = 0;

// Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ©
const deliveryPrices = {
  "Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©": { "home": 0, "desk": 0 },
  "Ø£Ø¯Ø±Ø§Ø±": { "home": 1100, "desk": 600 },
  "Ø§Ù„Ø´Ù„Ù": { "home": 700, "desk": 400 },
  "Ø§Ù„Ø£ØºÙˆØ§Ø·": { "home": 900, "desk": 500 },
  "Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ": { "home": 650, "desk": 400 },
  "Ø¨Ø§ØªÙ†Ø©": { "home": 700, "desk": 400 },
  "Ø¨Ø¬Ø§ÙŠØ©": { "home": 700, "desk": 400 },
  "Ø¨Ø³ÙƒØ±Ø©": { "home": 900, "desk": 500 },
  "Ø¨Ø´Ø§Ø±": { "home": 1100, "desk": 600 },
  "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©": { "home": 500, "desk": 250 },
  "Ø§Ù„Ø¨ÙˆÙŠØ±Ø©": { "home": 700, "desk": 400 },
  "ØªÙ…Ù†Ø±Ø§Ø³Øª": { "home": 1300, "desk": 800 },
  "ØªØ¨Ø³Ø©": { "home": 700, "desk": 400 },
  "ØªÙ„Ù…Ø³Ø§Ù†": { "home": 800, "desk": 400 },
  "ØªÙŠØ§Ø±Øª": { "home": 800, "desk": 400 },
  "ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ": { "home": 700, "desk": 400 },
  "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": { "home": 500, "desk": 250 },
  "Ø§Ù„Ø¬Ù„ÙØ©": { "home": 900, "desk": 500 },
  "Ø¬ÙŠØ¬Ù„": { "home": 700, "desk": 400 },
  "Ø³Ø·ÙŠÙ": { "home": 700, "desk": 400 },
  "Ø³Ø¹ÙŠØ¯Ø©": { "home": 800, "desk": 400 },
  "Ø³ÙƒÙŠÙƒØ¯Ø©": { "home": 600, "desk": 400 },
  "Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³": { "home": 700, "desk": 400 },
  "Ø¹Ù†Ø§Ø¨Ø©": { "home": 700, "desk": 400 },
  "Ù‚Ø§Ù„Ù…Ø©": { "home": 600, "desk": 400 },
  "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©": { "home": 600, "desk": 400 },
  "Ø§Ù„Ù…Ø¯ÙŠØ©": { "home": 700, "desk": 400 },
  "Ù…Ø³ØªØºØ§Ù†Ù…": { "home": 700, "desk": 400 },
  "Ø§Ù„Ù…Ø³ÙŠÙ„Ø©": { "home": 800, "desk": 400 },
  "Ù…Ø¹Ø³ÙƒØ±": { "home": 700, "desk": 400 },
  "ÙˆØ±Ù‚Ù„Ø©": { "home": 900, "desk": 500 },
  "ÙˆÙ‡Ø±Ø§Ù†": { "home": 800, "desk": 400 },
  "Ø§Ù„Ø¨ÙŠØ¶": { "home": 800, "desk": 500 },
  "Ø¥Ù„ÙŠØ²ÙŠ": { "home": 1300, "desk": 600 },
  "Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬": { "home": 700, "desk": 400 },
  "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³": { "home": 700, "desk": 400 },
  "Ø§Ù„Ø·Ø§Ø±Ù": { "home": 700, "desk": 400 },
  "ØªÙ†Ø¯ÙˆÙ": { "home": 1300, "desk": 600 },
  "ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª": { "home": 800, "desk": 400 },
  "Ø§Ù„ÙˆØ§Ø¯ÙŠ": { "home": 900, "desk": 500 },
  "Ø®Ù†Ø´Ù„Ø©": { "home": 700, "desk": 500 },
  "Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³": { "home": 700, "desk": 400 },
  "ØªÙŠØ¨Ø§Ø²Ø©": { "home": 700, "desk": 400 },
  "Ù…ÙŠÙ„Ø©": { "home": 500, "desk": 350 },
  "Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰": { "home": 700, "desk": 400 },
  "Ø§Ù„Ù†Ø¹Ø§Ù…Ø©": { "home": 800, "desk": 500 },
  "Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª": { "home": 800, "desk": 400 },
  "ØºØ±Ø¯Ø§ÙŠØ©": { "home": 900, "desk": 500 },
  "ØºÙ„ÙŠØ²Ø§Ù†": { "home": 700, "desk": 400 },
  "ØªÙŠÙ…ÙŠÙ…ÙˆÙ†": { "home": 1100, "desk": 600 },
  "Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±": { "home": 0, "desk": 0 },
  "Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„": { "home": 900, "desk": 500 },
  "Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³": { "home": 1100, "desk": 0 },
  "Ø¥Ù† ØµØ§Ù„Ø­": { "home": 1300, "desk": 600 },
  "Ø¥Ù† Ù‚Ø²Ø§Ù…": { "home": 0, "desk": 0 },
  "ØªÙ‚Ø±Øª": { "home": 900, "desk": 0 },
  "Ø¬Ø§Ù†Øª": { "home": 1100, "desk": 500 },
  "Ø§Ù„Ù…ØºÙŠØ±": { "home": 0, "desk": 0 },
  "Ø§Ù„Ù…Ù†ÙŠØ¹Ø©": { "home": 900, "desk": 0 }
};

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
const wilayaSelect = document.getElementById("wilaya");
Object.keys(deliveryPrices).forEach(w => {
  const opt = document.createElement("option");
  opt.value = w;
  opt.textContent = w;
  wilayaSelect.appendChild(opt);
});

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø§Ø³ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†
function getSizeByWeight(weight) {
  if(weight>=4 && weight<=9) return "XS";
  if(weight>=10 && weight<=14) return "S";
  if(weight>=15 && weight<=19) return "M";
  if(weight>=20 && weight<=24) return "L";
  if(weight>=25 && weight<=29) return "XL";
  if(weight>=30 && weight<=35) return "XXL";
  return "ØºÙŠØ± Ù…ØªÙˆÙØ±";
}

// Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
function addPiece() {
  pieceCount++;
  const container = document.getElementById("piecesContainer");
  const div = document.createElement("div");
  div.className = "piece";

  const weightOptions = Array.from({length:32},(_,i)=>`<option value="${i+4}">${i+4} ÙƒØº</option>`).join('');

  div.innerHTML = `
    <label>ğŸ§© Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„:</label>
    <select name="modal${pieceCount}" onchange="showModalImage(this,${pieceCount}); updatePrice();" required>
      <option value="">-- Ø§Ø®ØªØ± Ù…ÙˆØ¯Ø§Ù„ --</option>
      <option value="1">Ù…ÙˆØ¯Ø§Ù„ Ø±Ù‚Ù… 1</option>
      <option value="2">Ù…ÙˆØ¯Ø§Ù„ Ø±Ù‚Ù… 2</option>
      <option value="3">Ù…ÙˆØ¯Ø§Ù„ Ø±Ù‚Ù… 3</option>
      <option value="4">Ù…ÙˆØ¯Ø§Ù„ Ø±Ù‚Ù… 4</option>
      <option value="5">Ù…ÙˆØ¯Ø§Ù„ Ø±Ù‚Ù… 5</option>
    </select>
    <div id="modalImage${pieceCount}" style="margin-top:10px; text-align:center;"></div>

    <label>ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
    <select name="quantity${pieceCount}" onchange="updatePrice()" required>
      ${Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}
    </select>

    <label>ğŸ¨ Ø§Ù„Ù„ÙˆÙ†:</label>
    <select name="color${pieceCount}" required>
      <option value="Ø£Ø¨ÙŠØ¶">Ø£Ø¨ÙŠØ¶</option>
      <option value="Ø£Ø³ÙˆØ¯">Ø£Ø³ÙˆØ¯</option>
      <option value="Ø±Ù…Ø§Ø¯ÙŠ">Ø±Ù…Ø§Ø¯ÙŠ</option>
      <option value="Ø£Ø²Ø±Ù‚">Ø£Ø²Ø±Ù‚</option>
      <option value="Ø£Ø­Ù…Ø±">Ø£Ø­Ù…Ø±</option>
      <option value="Ø£Ø®Ø¶Ø±">Ø£Ø®Ø¶Ø±</option>
    </select>

    <label>âš–ï¸ ÙˆØ²Ù† Ø§Ù„Ø·ÙÙ„ (ÙƒØº):</label>
    <select name="weight${pieceCount}" onchange="updateSize(this,${pieceCount}); updatePrice();" required>
      ${weightOptions}
    </select>

    <label>ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³:</label>
    <input type="text" name="size${pieceCount}" id="size${pieceCount}" readonly>
  `;
  container.appendChild(div);
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ø³ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†
function updateSize(select,id){
  const weight = parseInt(select.value);
  document.getElementById(`size${id}`).value = getSizeByWeight(weight);
}

// Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
function showModalImage(select, id) {
  const imgDiv = document.getElementById(`modalImage${id}`);
  const value = select.value;
  if (!value) {
    imgDiv.innerHTML = "";
    return;
  }

  const modalImages = {
    "1": "images/modal1.jpg",
    "2": "images/modal2.jpg",
    "3": "images/modal3.jpg",
    "4": "images/modal4.jpg",
    "5": "images/modal5.jpg"
  };

  imgDiv.innerHTML = `<img src="${modalImages[value]}" alt="Ù…ÙˆØ¯Ø§Ù„ ${value}">`;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±
function updatePrice(){
  const pieces = document.querySelectorAll(".piece");
  let productPrice = 0;
  pieces.forEach(piece=>{
    const qty = parseInt(piece.querySelector('select[name^="quantity"]').value);
    productPrice += qty * 2000; // Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©
  });
  const wilaya = wilayaSelect.value;
  const deliveryType = document.getElementById("deliveryType").value;
  const deliveryCost = deliveryPrices[wilaya] ? deliveryPrices[wilaya][deliveryType] : 0;
  const total = productPrice+deliveryCost;
  document.getElementById("priceDetails").innerHTML=`ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${productPrice} Ø¯Ø¬ + ${deliveryCost} Ø¯Ø¬ ØªÙˆØµÙŠÙ„<br>ğŸ’¸ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ: ${total} Ø¯Ø¬`;
  return total;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ±
document.getElementById("orderForm").addEventListener("change", updatePrice);

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Google Apps Script
document.getElementById("orderForm").addEventListener("submit", function(e){
  e.preventDefault();

  const form = document.getElementById("orderForm");
  const formData = new FormData(form);
  const total = updatePrice();
  document.getElementById("loading").style.display = "block";
  fetch("https://script.google.com/macros/s/AKfycbyWFjyYt1TxAS6ub--A0GQtKQa_azETGo8tw6c3SezWuoF8_p6gNH9gKQEVLN07QC0M/exec", {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(data => {
    
    document.getElementById("loading").style.display = "none";
    alert(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­.\nØ³ÙŠØªØµÙ„ Ø¨Ùƒ ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©.\n\nğŸ’¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${total} Ø¯Ø¬`);
    form.reset();
    document.getElementById("piecesContainer").innerHTML = "";
    document.getElementById("priceDetails").innerHTML = "ğŸ’° Ø§Ù„Ø³Ø¹Ø±: 0 Ø¯Ø¬<br>ğŸ’¸ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ: 0 Ø¯Ø¬";
  })
  .catch(err => {
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
    console.error(err);
  });
});
</script>

</body>
</html>