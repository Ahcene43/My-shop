<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🛒 نموذج طلب الملابس</title>
<style>
  body {
    font-family: "Cairo", sans-serif;
    direction: rtl;
    background: linear-gradient(135deg,#f8f9fa,#e9ecef);
    margin: 0;
    padding: 20px;
    color: #2c3e50;
  }
  h2 {
    text-align: center;
    color: #2563eb;
    margin-bottom: 20px;
  }
  form {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 700px;
    margin: auto;
  }
  label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
  }
  input, select { 
    width:97%; 
    padding:10px; 
    margin-top:7px; 
    border:1px solid #ccc; 
    border-radius:6px; 
    font-size:18px; 
  }
  button {
    background: #2563eb;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
    width: 97%;
    font-size: 16px;
  }
  button:hover {
    background: #1e40af;
  }
  .piece {
    border: 2px dashed #2563eb;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    background: #f0f9ff;
  }
  .piece img {
    display: block;
    margin: 10px auto;
    max-width: 200px;
    border-radius: 10px;
  }
  #priceDetails {
    margin-top: 15px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>🛒 طلبية ملابس</h2>
  
<form id="orderForm">
  <label>👤 الاسم الكامل:</label>
  <input type="text" name="name" required>

  <label for="phone">📦 رقم الهاتف:</label>
  <input type="tel" id="phone" name="phone"
      dir="rtl"
      placeholder="أدخل رقم الهاتف"
      pattern="^[0-9]{10}$"
      maxlength="10"
      required
      oninvalid="this.setCustomValidity('الرجاء إدخال رقم هاتف صحيح مكون من 10 أرقام')"
      oninput="this.setCustomValidity('')">

  <label>📍 الولاية:</label>
  <select id="wilaya" name="wilaya" required></select>

  <label>📍 الدائرة:</label>
  <input type="text" name="daire" required>

  <label>🏠 العنوان الكامل:</label>
  <input type="text" name="address" required>

  <div id="piecesContainer"></div>
  <button type="button" onclick="addPiece()">➕ أطلب نوعية</button>

  <label>🚚 نوع التوصيل:</label>
  <select id="deliveryType" name="deliveryType">
    <option value="home">إلى المنزل</option>
    <option value="desk">إلى المكتب</option>
  </select>

  <div id="priceDetails">
    💰 السعر: 0 دج<br>
    💸 السعر الكلي: 0 دج
  </div>

  <button type="submit">✅ إرسال الطلب</button>
  
  <div id="loading" style="display:none; text-align:center; margin-top:15px;">
  <img src="https://i.gifer.com/ZZ5H.gif" alt="جاري الإرسال..." width="60">
  <p>⏳ جاري معالجة طلبك...</p>
</div>
</form>

<script>
let pieceCount = 0;

// أسعار التوصيل لكل ولاية
const deliveryPrices = {
  "أدخل الولاية": { "home": 0, "desk": 0 },
  "أدرار": { "home": 1100, "desk": 600 },
  "الشلف": { "home": 700, "desk": 400 },
  "الأغواط": { "home": 900, "desk": 500 },
  "أم البواقي": { "home": 650, "desk": 400 },
  "باتنة": { "home": 700, "desk": 400 },
  "بجاية": { "home": 700, "desk": 400 },
  "بسكرة": { "home": 900, "desk": 500 },
  "بشار": { "home": 1100, "desk": 600 },
  "البليدة": { "home": 500, "desk": 250 },
  "البويرة": { "home": 700, "desk": 400 },
  "تمنراست": { "home": 1300, "desk": 800 },
  "تبسة": { "home": 700, "desk": 400 },
  "تلمسان": { "home": 800, "desk": 400 },
  "تيارت": { "home": 800, "desk": 400 },
  "تيزي وزو": { "home": 700, "desk": 400 },
  "الجزائر": { "home": 500, "desk": 250 },
  "الجلفة": { "home": 900, "desk": 500 },
  "جيجل": { "home": 700, "desk": 400 },
  "سطيف": { "home": 700, "desk": 400 },
  "سعيدة": { "home": 800, "desk": 400 },
  "سكيكدة": { "home": 600, "desk": 400 },
  "سيدي بلعباس": { "home": 700, "desk": 400 },
  "عنابة": { "home": 700, "desk": 400 },
  "قالمة": { "home": 600, "desk": 400 },
  "قسنطينة": { "home": 600, "desk": 400 },
  "المدية": { "home": 700, "desk": 400 },
  "مستغانم": { "home": 700, "desk": 400 },
  "المسيلة": { "home": 800, "desk": 400 },
  "معسكر": { "home": 700, "desk": 400 },
  "ورقلة": { "home": 900, "desk": 500 },
  "وهران": { "home": 800, "desk": 400 },
  "البيض": { "home": 800, "desk": 500 },
  "إليزي": { "home": 1300, "desk": 600 },
  "برج بوعريريج": { "home": 700, "desk": 400 },
  "بومرداس": { "home": 700, "desk": 400 },
  "الطارف": { "home": 700, "desk": 400 },
  "تندوف": { "home": 1300, "desk": 600 },
  "تيسمسيلت": { "home": 800, "desk": 400 },
  "الوادي": { "home": 900, "desk": 500 },
  "خنشلة": { "home": 700, "desk": 500 },
  "سوق أهراس": { "home": 700, "desk": 400 },
  "تيبازة": { "home": 700, "desk": 400 },
  "ميلة": { "home": 500, "desk": 350 },
  "عين الدفلى": { "home": 700, "desk": 400 },
  "النعامة": { "home": 800, "desk": 500 },
  "عين تموشنت": { "home": 800, "desk": 400 },
  "غرداية": { "home": 900, "desk": 500 },
  "غليزان": { "home": 700, "desk": 400 },
  "تيميمون": { "home": 1100, "desk": 600 },
  "برج باجي مختار": { "home": 0, "desk": 0 },
  "أولاد جلال": { "home": 900, "desk": 500 },
  "بني عباس": { "home": 1100, "desk": 0 },
  "إن صالح": { "home": 1300, "desk": 600 },
  "إن قزام": { "home": 0, "desk": 0 },
  "تقرت": { "home": 900, "desk": 0 },
  "جانت": { "home": 1100, "desk": 500 },
  "المغير": { "home": 0, "desk": 0 },
  "المنيعة": { "home": 900, "desk": 0 }
};

// إضافة الولايات للقائمة
const wilayaSelect = document.getElementById("wilaya");
Object.keys(deliveryPrices).forEach(w => {
  const opt = document.createElement("option");
  opt.value = w;
  opt.textContent = w;
  wilayaSelect.appendChild(opt);
});

// دالة لتحديد المقاس حسب الوزن
function getSizeByWeight(weight) {
  if(weight>=4 && weight<=9) return "XS";
  if(weight>=10 && weight<=14) return "S";
  if(weight>=15 && weight<=19) return "M";
  if(weight>=20 && weight<=24) return "L";
  if(weight>=25 && weight<=29) return "XL";
  if(weight>=30 && weight<=35) return "XXL";
  return "غير متوفر";
}

// إضافة قطعة جديدة
function addPiece() {
  pieceCount++;
  const container = document.getElementById("piecesContainer");
  const div = document.createElement("div");
  div.className = "piece";

  const weightOptions = Array.from({length:32},(_,i)=>`<option value="${i+4}">${i+4} كغ</option>`).join('');

  div.innerHTML = `
    <label>🧩 اختر المودال:</label>
    <select name="modal${pieceCount}" onchange="showModalImage(this,${pieceCount}); updatePrice();" required>
      <option value="">-- اختر مودال --</option>
      <option value="1">مودال رقم 1</option>
      <option value="2">مودال رقم 2</option>
      <option value="3">مودال رقم 3</option>
      <option value="4">مودال رقم 4</option>
      <option value="5">مودال رقم 5</option>
    </select>
    <div id="modalImage${pieceCount}" style="margin-top:10px; text-align:center;"></div>

    <label>🔢 الكمية:</label>
    <select name="quantity${pieceCount}" onchange="updatePrice()" required>
      ${Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}
    </select>

    <label>🎨 اللون:</label>
    <select name="color${pieceCount}" required>
      <option value="أبيض">أبيض</option>
      <option value="أسود">أسود</option>
      <option value="رمادي">رمادي</option>
      <option value="أزرق">أزرق</option>
      <option value="أحمر">أحمر</option>
      <option value="أخضر">أخضر</option>
    </select>

    <label>⚖️ وزن الطفل (كغ):</label>
    <select name="weight${pieceCount}" onchange="updateSize(this,${pieceCount}); updatePrice();" required>
      ${weightOptions}
    </select>

    <label>📏 المقاس:</label>
    <input type="text" name="size${pieceCount}" id="size${pieceCount}" readonly>
  `;
  container.appendChild(div);
}

// تحديث المقاس تلقائياً حسب الوزن
function updateSize(select,id){
  const weight = parseInt(select.value);
  document.getElementById(`size${id}`).value = getSizeByWeight(weight);
}

// عرض صورة المودال
function showModalImage(select, id) {
  const imgDiv = document.getElementById(`modalImage${id}`);
  const value = select.value;
  if (!value) {
    imgDiv.innerHTML = "";
    return;
  }

  const modalImages = {
    "1": "images/modal1.jpg",
    "2": "images/modal2.jpg",
    "3": "images/modal3.jpg",
    "4": "images/modal4.jpg",
    "5": "images/modal5.jpg"
  };

  imgDiv.innerHTML = `<img src="${modalImages[value]}" alt="مودال ${value}">`;
}

// تحديث السعر
function updatePrice(){
  const pieces = document.querySelectorAll(".piece");
  let productPrice = 0;
  pieces.forEach(piece=>{
    const qty = parseInt(piece.querySelector('select[name^="quantity"]').value);
    productPrice += qty * 2000; // سعر الوحدة
  });
  const wilaya = wilayaSelect.value;
  const deliveryType = document.getElementById("deliveryType").value;
  const deliveryCost = deliveryPrices[wilaya] ? deliveryPrices[wilaya][deliveryType] : 0;
  const total = productPrice+deliveryCost;
  document.getElementById("priceDetails").innerHTML=`💰 السعر: ${productPrice} دج + ${deliveryCost} دج توصيل<br>💸 السعر الكلي: ${total} دج`;
  return total;
}

// تحديث السعر عند أي تغيير
document.getElementById("orderForm").addEventListener("change", updatePrice);

// إرسال الطلب إلى Google Apps Script
document.getElementById("orderForm").addEventListener("submit", function(e){
  e.preventDefault();

  const form = document.getElementById("orderForm");
  const formData = new FormData(form);
  const total = updatePrice();
  document.getElementById("loading").style.display = "block";
  fetch("https://script.google.com/macros/s/AKfycbyWFjyYt1TxAS6ub--A0GQtKQa_azETGo8tw6c3SezWuoF8_p6gNH9gKQEVLN07QC0M/exec", {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(data => {
    
    document.getElementById("loading").style.display = "none";
    alert(`✅ تم إرسال طلبك بنجاح.\nسيتصل بك فريق المبيعات قريبًا لتأكيد الطلبية.\n\n💸 المجموع الكلي: ${total} دج`);
    form.reset();
    document.getElementById("piecesContainer").innerHTML = "";
    document.getElementById("priceDetails").innerHTML = "💰 السعر: 0 دج<br>💸 السعر الكلي: 0 دج";
  })
  .catch(err => {
    alert("❌ حدث خطأ أثناء الإرسال، حاول مرة أخرى.");
    console.error(err);
  });
});
</script>

</body>
</html>